<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>色々な5インチFDDをAT互換機に付けてみる -- もしかしたら開発室</title>
<style>
<!--
	/* 全体的な */
	* {
		margin:0;
		padding:0;
	}
	body {
		font-family:monospace;
		font-size:16px;
		color:#FFFFFF;
		background-color:#000000;
		margin-left:8px; margin-right:8px;
		line-height: 1.4;
	}
	h1 {font-size:28px; margin-top:16px; margin-bottom:16px; padding:8px; text-align: center; color:#000000; background:#C0C0C0;}
	h2 {font-size:24px; margin-top:3ex; padding:8px; border-top:1px solid #C0C0C0; border-bottom:1px solid #C0C0C0; width:100%;}
	h3 {font-size:20px; margin-top:1ex; padding:8px; border-bottom:1px solid #404040; width:100%;}
	h4 {font-size:16px;}
	
	p {margin-top:0.5ex; margin-bottom:1ex; text-indent: 1em;}
	
	table {font-size:14px; margin-left:10%; margin-right:10%; margin-top:3ex; margin-bottom:3ex; border-collapse:collapse; border:1px solid #C0C0C0;}
	th {padding:2px; border:1px solid #C0C0C0; background:#404040;}
	td {padding:2px; border:1px solid #C0C0C0;}

	/* 特定用途用 */
	.body {margin-right:5%;}
	.block {margin-top:1ex; margin-bottom:3ex; margin-left:1em;}
	.list {margin-top:0.5ex; margin-bottom:1ex; margin-left:3em;}
	
	.memo {display:table; border:1px solid #808080; margin-left:10%; margin-right:10%; margin-top:2ex; margin-bottom:2ex;}
	.memo_blk1 {display: table-cell; padding:8px; white-space:nowrap; font-weight:bold;}
	.memo_blk2 {display: table-cell; padding:8px; font-size:14px; margin-right:10%; color:#E0E0E0;}

	.header {text-align:right; font-size:12px;}
	.footer {margin-top:2ex; padding:8px; border-top:1px solid #C0C0C0;}

	/* リンクスタイル */
	a:link {color:#8080FF;}
	a:visited {color:#FFC080;}
	a:active {color:#FF8080;}
-->
</style>
</head>

<body>
<h1>色々な5インチFDDをAT互換機に付けてみる</h1>
<div style="text-align: center">
	<img src="./image/5inch/main_pc.jpg" alt="PRIMERGY TX100 S1に内蔵されたFD-55GFR(7000番台)">
</div>

<div class="body">
<h2>はじめに</h2>
<div class="block">
	<p>困ったことに、我が家では未だに(2015年1月現在)5.25インチのフロッピィディスクが現役です。というのも、</p>
	<ul class="list">
		<li>5インチフロッピィモデルのPC-9801FAが頭上に鎮座しているが、手持ちの外付けドライブも5.25インチしかない。</li>
		<li>この98とのデータ交換の為に、元々AT互換機で5.25インチFDDを運用していた経験がある。</li>
		<li>メインマシンを新しくした際(富士通 PRIMERGY TX100 S1)、空きベイ/スペースの都合から、<b>5.25インチFDDしか取り付けられなかった。</b></li>
		<li>でもPC用のOSを作る実験をしたいので、簡単にブートできるFDDは搭載必須。</li>
		<li>サブ機にも5インチフロッピィドライブを付けようと思えば付けられる状態になっている。</li>
		<li>FM TOWNS用の外付け5インチドライブを持っている。</li>
		<li>たまたま5インチ2HDディスクのストックもある。</li>
	</ul>
	<br>
	<p><b>→もう5インチに統一で良ぐね?  ＼(^o^)／</b></p>
	<br>
	<div>……という投げやりになりたい状況へ陥ったからなのです。</div>
	<p>こういう使い方でなくとも、例えばリプレース前のシステムで5インチフロッピィを使っていててデータを救出したいとか、そういった用途で5インチフロッピィドライブを現代のAT互換機に繋ぐ必要が出てくることはあると思います。</p>
	<p>そこで、このページでは、AT互換機に5インチフロッピィを繋いで運用するために必要な諸々の情報を書き綴っておきたいと思います。</p>
	<p>他の用途(FDDインタフェースの研究、マイナーなドライブ/機種をジャンクハントしたとき等)にも役立つように、本題以外の周辺情報も含めて書き垂らしておきます。まさにAT互換機に5インチFDDを繋ぐ必要性にかられて急いでいる方は、一番後ろから読むとラクかもしれません;-)</p>
</div>

<h2 id="connect">フロッピィインタフェースに関する詳細</h2>
<div class="block">
	<p>まずは戦う相手のことを理解することから始めます。</p>
	
	<div class="memo">
		<div class="memo_blk1">注:</div>
		<div class="memo_blk2"><p>ここでは、34ピンコネクタを使って3.5インチの内蔵FDDが接続できるAT互換機を対象にしています。最近ではFDDの内蔵ができない機種も多く、さらにFDDコネクタがあっても、Bドライブ側の配線は省略されている場合が殆どなので注意が必要です(FDCレベルで実装が省略されています)。但し、FDDコネクタさえ存在するのであれば、最低限5インチFDDのみをAドライブに接続して使うことは可能です。</p></div>
	</div>
	
	<p>AT互換機側のFDD接続用インタフェースはシュガート SA-400と上位互換の34ピンバスが使われています。
	奇数ピン側は全てGNDに落ちていて、偶数ピン側に信号が割り当てられています。
	各ラインはオープンコレクタ出力で、受信端に於いて150Ω以上の抵抗でプルアップし、TTLで入力しているようです(つまり、信号線が誤ってどこかでGNDに落ちていてたり、複数のデバイスが同時に信号をドライブしてしまっても、ショートすることはありません)。信号論理は全て負論理です(プルアップ状態であれば、LO = アサート、HI = ネゲート)。
	これはフロッピィドライブの業界標準とでもいえるインタフェースで、例えばPC-9800シリーズ等で使われている5インチドライブと<b>「大体」同じ</b>です。</p>
	
	<p>参考として、以下に<a href="https://archive.org/details/bitsavers_shugartSA478_3019449">SA-400 OEMマニュアル</a>に記載のピンアサインを記載します。</p>
	
	<table>
		<tr><th>ピン</th><th>名称</th><th>方向(出力する側)</th><th>解説</th></tr>
		<tr><td>#6</td><td>(DRIVE SELECT 4)</td><td>ホスト</td><td>SA-400には存在しませんが、このピンを4台目のドライブセレクトとして使用する実装が多いです。</td></tr>
		<tr><td>#8</td><td>INDEX(SECTOR)</td><td>ドライブ</td><td>インデックスホール検出時にLパルスが出ます。</td></tr>
		<tr><td>#10</td><td>DRIVE SELECT 1</td><td>ホスト</td><td rowspan=3>ホストが制御対象とするドライブを選択します(アクセス期間中、対象ドライブの線をアサートしておく)。ドライブからの出力ピンもこの線の影響を受けます(選択されたドライブからだけ出力される)。</td></tr>
		<tr><td>#12</td><td>DRIVE SELECT 2</td><td>ホスト</td></tr>
		<tr><td>#14</td><td>DRIVE SELECT 3</td><td>ホスト</td></tr>
		<tr><td>#16</td><td>MOTOR ON</td><td>ホスト</td><td>全ドライブのスピンドルモータ回転を制御します(アサートで回転)。このピンはドライブセレクトの影響を受けませんので注意してください。</td></tr>
		<tr><td>#18</td><td>DIRECTION SELECT</td><td>ホスト</td><td>ヘッドの移動方向を制御します(Lでディスクの中心方向、Hで外方向 = 0トラック側)。STEP線のL→H遷移エッジで参照されます。</td></tr>
		<tr><td>#20</td><td>STEP</td><td>ホスト</td><td>L→H遷移エッジで、DIRECTION SELECT線で指定された方向にヘッドを1トラック移動します。</td></tr>
		<tr><td>#22</td><td>WRITE DATA</td><td>ホスト</td><td>ディスクへ書き込む、クロック/データ重畳波形を出力します。WRITE GATE線アサート期間中のみ有効です。</td></tr>
		<tr><td>#24</td><td>WRITE GATE</td><td>ホスト</td><td>ディスクへの書き込みを行いたい期間にアサートします。</td></tr>
		<tr><td>#26</td><td>TRACK 00</td><td>ドライブ</td><td>ヘッドがトラック0上にある場合にアサートされます。</td></tr>
		<tr><td>#28</td><td>WRITE PROTECT</td><td>ドライブ</td><td>書き込み禁止シールが検出されている場合にアサートされます。</td></tr>
		<tr><td>#30</td><td>READ DATA</td><td>ドライブ</td><td>ディスクから読み出された、クロック/データ重畳波形が出力されます。</td></tr>
	</table>
	
	<p>まぁ、ATと98はFDCも同じものを使っている(日本電気 μPD765A互換です)ので同じである方が普通なのですが、
	困ったことに、<b>SA-400に存在しなかったピンの取り扱いが各社各機種で異なっているため</b>、そのままでは上手く扱えない場合があります。</p>
	
	<p>以下に、代表としてAT互換機側インタフェースとPC-9800シリーズのインタフェースの差異(ドライブ側に影響があるもの)をまとめます。</p>
	
	<p>尚、説明中の略称ですが、DS条件 = 自身に対するDRIVE SELECTとみなす条件、MON条件 = スピンドルモータを回転させる条件、NC = 未接続です。</p>
	
	<table>
		<tr>
			<th>主な差異</th>
			<th>98での対応</th>
			<th>ATでの対応</th>
		</tr>
		<tr>
			<!-- テーマ -->	<td>ヘッドロード条件</td>
			<!-- 98 -->		<td>DS条件 & MON条件 & HEAD LOAD信号(4番)</td>
			<!-- AT -->		<td>DS条件 & MON条件。4番はNC。</td>
		</tr>
		<tr>
			<!-- テーマ -->	<td>34ピンの取り扱い</td>
			<!-- 98 -->		<td>READY信号</td>
			<!-- AT -->		<td>DISK CHANGE信号(2HD/2DD)<br>NC(2D以前)</td>
		</tr>
		<tr>
			<!-- テーマ -->	<td>5インチ2DD</td>
			<!-- 98 -->		<td>あり(2ピン出力でモード切替)</td>
			<!-- AT -->		<td>規格上存在しない(2ピン実装は機種/FDC依存)</td>
		</tr>
		<tr>
			<!-- テーマ -->	<td>VFO回路</td>
			<!-- 98 -->		<td>メインボード側、又はFDD側(機種によって異なる)</td>
			<!-- AT -->		<td>メインボード側</td>
		</tr>
	</table>
	
	<p>また、丁度手持ちにFM TOWNSがあるので、そちらとの差異もまとめておきます。</p>
	
	<table>
		<tr>
			<th>主な差異</th>
			<th>TOWNSでの対応</th>
			<th>ATでの対応</th>
		</tr>
		<tr>
			<!-- テーマ -->	<td>アクセスランプ点灯条件</td>
			<!-- TW -->		<td>IN USE信号(4番)を使って自由制御。</td>
			<!-- AT -->		<td>ヘッドロード条件を満たしたとき。4番はNC。</td>
		</tr>
		<tr>
			<!-- テーマ -->	<td>34ピンの取り扱い</td>
			<!-- TW -->		<td>READY信号</td>
			<!-- AT -->		<td>DISK CHANGE信号(2HD/2DD)<br>NC(2D以前)</td>
		</tr>
		<tr>
			<!-- テーマ -->	<td>5インチ2DD</td>
			<!-- TW -->		<td>あり(2ピン出力でモード切替)</td>
			<!-- AT -->		<td>規格上存在しない(2ピン実装は機種/FDC依存)</td>
		</tr>
	</table>
	
	<p>つまり、これらの差異を、ドライブ側の設定なり外付け回路なりで無くしてやれば、相互にドライブの交換ができるということになります。</p>
	
	<div class="memo">
		<div class="memo_blk1">ヘッドロード条件</div>
		<div class="memo_blk2"><p>ヘッドロードとは、読み書きヘッドをディスクに接触させることを指します。</p>
		<p>ディスクにヘッドが接触した状態で長時間ディスクを回転させると、ディスクの接触面が磨耗して薄くなり、ついには読み書きできなくなってしまいます。このため、アクセスしていない間はディスクの回転を止めるか、ヘッドをディスクから離すかして回避していた訳です。90年代以降の5インチ/3.5インチFDDは、ヘッドロード制御用のソレノイドを省略して常時接触としているものが多いので、基本的に前者の制御をとります。FDD全盛期には、高速アクセスできる後者の方が好まれていたようです(回転を止めてしまうと、スピンアップ後に回転が安定するまで500ms程待つ必要があるので、とても遅くなります)。</p>

		<p>SA-400本来のバスにHEAD LOAD信号は存在しません(ATと同じ条件?)。実際、アクセス時だけドライブセレクトすれば必要最低限のヘッドロードは実現できるので、FMR系等のようにHEAD LOAD信号を用いない環境も多いです。一方、8インチドライブの信号には元々存在していたようで、そのころから存在するFDCであるμPD765Aには、HEAD LOAD出力が存在します。また、専用の制御線を用意すれば、シーク時にはヘッドを離しておくことが可能なので、さらなる寿命延長も期待できます。</p></div>
	</div>
	
	<div class="memo">
		<div class="memo_blk1">34ピンの取り扱い</div>
		<div class="memo_blk2">
		<p>地味に厄介な違いです。多くの機種でディスクの挿入検出に使われているという点では共通なのですが、生成方法や解除条件が全く異なる2種類の信号がメジャーになっているのが困ったところです。98を含めたほとんどの環境ではREADY信号を使っています。つまり、ディスクの回転が安定している間アサートされる信号です。
		一方、AT互換機ではDISK CHANGE信号を使っていて、ディスクの交換検出でアサートされます。やや詳細な遷移条件を以下に示します。</p>
		
		<table>
			<tr>
				<th>信号名</th>
				<th>アサート条件</th>
				<th>ネゲート条件</th>
			</tr>
			<tr>
				<!-- 名 -->	<td>READY</td>
				<!-- A -->	<td>インデックスホールのパルスを規定回数以上検出。</td>
				<!-- N -->	<td>インデックスホールのパルスが一定期間検出されない。</td>
			</tr>
			<tr>
				<!-- 名 -->	<td>DISK CHANGE</td>
				<!-- A -->	<td>リセット直後、ディスク排出検出。</td>
				<!-- N -->	<td>ディスク挿入後、初回のステッピング動作。ディスクが入っていなければステップされてもアサートのまま。</td>
			</tr>
		</table>
		
		<p>BIOS経由でのディスクアクセスやWindows NT系の標準ドライバでは、この信号をちゃんと使っていますので、これらの環境で使用する場合は34ピンにDISK CHANGE信号が出るようにドライブを設定できる必要があります。例外として、SA-400を含めた初期のドライブ(主に2D以前の一部)では34ピンがNCだったそうなので、BIOSのドライブ設定で「5インチ 360KB」にしておくと、Windowsの標準ドライバでは34ピンを見ずにディスクアクセスするようになります。</p>
		
		<p>また、Windows上で使う場合は、<a href="#oredrv">拙作ドライバ</a>を使うことでREADY信号しか出ないドライブでも使用可能です。</p>
		
		<p>ちなみに、一見DISK CHANGE信号が出せそうなジャンパ設定があっても、なぜか34ピンの出力論理が固定されて使い物にならないドライブを複数確認していますのでご注意下さい(後述)。</p>
		</div>
	</div>
	
	<div class="memo">
		<div class="memo_blk1">2DDモード</div>
		<div class="memo_blk2">
		<p>5.25インチでは、2DD以前と2HDとで、回転数・データレート・磁性体の種類に至るまで異なっています。そのため、どちらの媒体を使うかによってドライブ側の制御を切り換える必要があるのですが、困ったことに、媒体自身が「どちらのタイプのメディアか」を示す手段が定義されていません。このため、ホスト側から信号線を使ってモードを切り換える対応が一般的です。主な違いを以下に示します(詳細はJIS X 6211を参照)。</p>
		
		<table>
			<tr>
				<th>項目</th>
				<th>2DD</th>
				<th>2HD</th>
			</tr>
			<tr>
				<!-- 名 -->	<td>回転数</td>
				<!-- D -->	<td>300rpm</td>
				<!-- H -->	<td>360rpm</td>
			</tr>
			<tr>
				<!-- 名 -->	<td>データレート</td>
				<!-- D -->	<td>250kbps</td>
				<!-- H -->	<td>500kbps</td>
			</tr>
			<tr>
				<!-- 名 -->	<td>磁性体</td>
				<!-- D -->	<td>ガンマ酸化鉄</td>
				<!-- H -->	<td>コバルト・ガンマ酸化鉄</td>
			</tr>
		</table>
		
		<p>PC-9800シリーズでは、極初期(M/F等)を除き、同一ドライブによる2HD/2DDの両対応(自動切替)が行われています。
		どちらのモードを使うかどうかは、信号線の2番ピンによってドライブに通知されます(アサート = 2DD、ネゲート = 2HD)。
		但し対応方法が少し特殊で、ディスクの回転数は360rpm固定とし、2DD時のデータレートを300kbpsにすることで辻褄を合わせています(回転数切り替え時の遅延を回避している訳ですね)。</p>
		
		<p>一方、IBM PCの歴史上では5インチフロッピィの2DDがありません。しかも1S/2D/2HDでそれぞれ専用のドライブを使っていたようです。
		また、3.5インチの場合はディスク上のヘコミで2HD/2DDの識別ができますので、ホストから2DDかどうかを通知する必要はありません。
		このため、標準の機能だけでは2番ピンを制御する手段がなく、2DD/2HDの自動切替は困難です。</p>
		
		<p>尚、ドライブ側で2DD固定モードにできるのであれば、5インチ2DDの読み書き自体は可能です。この場合、規格通り回転数300rpmとなるようにドライブ側を設定する必要があります。また、PC-9800シリーズと2ピンの論理が同じドライブであれば、AT側の2ピンは原則ネゲートですので、そのままで2HD専用ドライブとして使うことが可能てす。</p>
		
		<p>例外として、AT互換機でも搭載されているFDC(スーパI/Oコントローラ)の実装次第では、2ピンの制御機能や300kbpsのデータレートを持っていたりします。ようは3.5インチでの3モードFDD対応のオマケみたいな機能なんですが、BIOS側で適切に初期化されていれば、専用のドライバが無くともデータレートの切替に連動して2ピンが制御される場合があります。例えば、うちのメインマシン(富士通 PRIMERGY TX100 S1)では、BIOSの設定に「5インチ 1.2MB」ドライブに設定しておくと、Windows上でデータレートを250kbpsに切り換えたときに2ピンをアサートしてくれているようです(ドライブの回転数が変わります)。そうでない場合も、適切なドライバを作成することによって2DD/2HDの切替に対応できる場合があります(例えば、<a href="#oredrv">拙作ドライバ</a>では何種類か実装しています)。</p>
		</div>
	</div>
	
	<div class="memo">
		<div class="memo_blk1">VFO回路</div>
		<div class="memo_blk2">
		<p>フロッピィ上のデータはクロックとデータが合成された信号として記録されていますが、リード時に解釈するためにはデータ成分/クロック成分を区別して抽出する必要があります。しかし、実際にディスクから読みだされた生データは、書き込み/読み込み時の回転ムラ等の影響で、書き込み単位毎に異なる時間方向の誤差を持っています(極端な例だと、1セクタ毎に微妙に異なる周波数で書かれているように見えます)。つまり、そのままでは各パルスの間隔が決め打ちできず、クロック成分とデータ成分の正確な区別が困難です。そこで、予めディスク上の各データ(IDやセクタの実データ)先頭にはクロック成分だけのデータを少し書いておき(SYNC部)、このクロック成分にPLL(位相同期回路)をロックさせることで、実際に観測されたクロックと同じ周波数のクロック信号を得ます。あとはこの信号にしたがってリードデータをサンプルすれば、データ成分 / クロック成分を正確に区別できる…というわけです。このPLLにあたる部分が、フロッピィにおけるVFO(可変周波数発振)回路の役割です。</p>
		
		<p>PC-9800シリーズの大半では、このVFO回路をメインボード側ではなくFDD上に搭載しているものがあります。この場合、搭載されているFDDの型番末尾が"D"となるそうです。AT互換機を含めた一般的なものだと、このVFO回路はマザーボード上に実装されます。</p>
		
		<p>このため、これらのドライブをAT互換機に繋ぐ場合はFDD側のVFO回路を無効にすべし…となるのですが、DCのデータシート(μPD765Aや、後継のμPD72065のもの)を見ると、READ DATA信号自体はクロック/データ分離前の生データのまま入力するようです。</p>
		<img src="./image/5inch/upd72064_vfo.gif" alt="当該データシートでのFDC周辺システム構成図">
		<p>よくよく考えると、クロック成分もFDCで見ていないとミッシングクロック(意図的にクロックを記録しない箇所…ID等特殊なデータが書かれる直前に配置)の区別がつかないので、当然といえば当然なのかもしれません。</p>
		<p>ええと、つまり、AT互換機から見れば、PC-9800シリーズ用のVFOありのFDDであってもREAD DATAの出力は同じで、余計な信号線が3本増えただけとなるので、特に気にする必要はなさそうです。</p>
		
		<p>唯一心配なのは、上記ドライブのWINDOW出力がインタフェースの3ピンに出ていて、これがAT互換機だとGNDに落ちていることなのですが…。
		まさかオープンコレクタになっていない…なんてことはないよね…?</p>
		</div>
	</div>
	
	<div class="memo">
		<div class="memo_blk1">IN USE信号</div>
		<div class="memo_blk2">
		<p>FMRシリーズやFM TOWNSシリーズでは、4番ピンにIN USE信号を割り当てています。
		これは、ディスクのアクセス状況(MOTOR ON信号やDRIVE SELECT信号)とは独立してアクセスランプの制御が行えるものです。</p>
		<p>「富士通FMRシリーズ徹底解析マニュアル(通称白本)」によれば、以下のような信号だそうです。</p>
		<ul class="list">
			<li>DRIVE SELECT信号がアサートされるタイミングで、ドライブにラッチされる</li>
			<li>このとき、IN USE信号がアサートされているとアクセスランプ点灯、ネゲートされていると消灯…となる</li>
			<li>ドライブセレクトが解除されてからも状態が保持される</li>
		</ul>
		<p>例えばFMR/TOWNSのFM-OASYSでは、編集中に文書側とシステム側の両方のドライブのアクセスランプを
		付けっぱなしにして、「今抜かないで欲しい」という意思表示を行っています。</p>
		</div>
	</div>
	
</div>


<h2>AT互換機とドライブの繋ぎ方</h2>
<div class="block">
	<p>ここまでの条件を満たしたドライブを見つけたなら、あとはAT互換機に繋ぐだけ…なのですが、ここでいくつかハマリ所があるので説明します。</p>
	
	<h3>DRIVE SELECTの設定が固定(ケーブル接続位置依存)</h3>
	<div class="block">
		<p>AT互換機用のケーブルでは、一部の線(10～16ピン)が途中でクロスされているものが使われています。	これはドライブセレクトの設定を所謂「ケーブルセレクト」として使えるようにしているもので、クロスよりもマザーボード側がBドライブ、クロスの先がAドライブ側となります。そして、どちらのドライブにも、ドライブセレクトの1番(つまり2台目)が供給されることになります。AT互換機に取り付ける際は、ドライブセレクトの設定に注意して下さい。</p>
		<p>ついでに言うと、MOTOR ON信号についても両ドライブで独立して供給できるようになっています(同じく、ドライブ側ではどちらもMOTOR ON信号のラインに接続されるので、気にする必要はありません)。なので、MOTOR ON条件に「MOTOR ON信号」として設定しておいても、全てのドライブが一斉にモータオンしたりしません。</p>
	</div>

	<h3>カードエッジコネクタが希少品</h3>
	<div class="block">
		<p>一般的に、5インチFDDの接続にはカードエッジタイプが使われていますが、3.5インチFDDではピンヘッダタイプが一般的です。このため、現在市販されているAT互換機用のFDDケーブルには、カードエッジコネクタがついているものは非常に少ないです。たとえ付いていたとしても、「Aドライブ側にはピンヘッダだけ」というケーブルもあったりするので厄介です。特に、Aドライブ側は前述のクロス部分が信号アサイン上重要な意味を持っていますので、他の機種からケーブルを直接流用できず、特にシングルドライブ運用しかできない環境で非常に問題となります。</p>
		<p>いくつか回避策を考えるとすれば以下でしょうか。</p>
		<ul class="list">
			<li>粘り強く新品・デッドストック・中古・ジャンクケーブルを漁る</li>
			<li>3.5インチ用のFDDケーブルと、リボンケーブル(フラットケーブル)への圧着用カードエッジコネクタを用意し、自分でコネクタを増やす</li>
			<li>リボンケーブルの特注加工をやってくれるケーブル屋さんに頼む</li>
			<li>ピンヘッダ→カードエッジコネクタ変換基板を自力で作る</li>
		</ul>
	</div>

</div>


<h2>じゃぁ実際に使えるドライブは?</h2>
<div class="block">
	<p>じゃあ、実のところ、簡単に手に入るようなドライブはAT互換機で使えるのか?という話です。かなり昔に手持ちのドライブ達を動員して試した結果を以下に掲載します。尚、ここではドライブ自体を改造せず、ジャンパ設定だけで動作可能かを検証しています。</p>
	<p>結果の凡例については以下です。</p>
	<ul class="list">
		<li>○ = 「適切な設定を行えば支障なく使うことが可能」</li>
		<li>△ = 「設定を行っても一部動作に難がある」</li>
		<li>× = 「設定を行っても動作不可、又は設定が存在しない」</li>
		<li>－ = 「機能が無いため該当しない」</li>
		<li>？ = 「確認できていない」</li>
	</ul>
	
	<table>
		<tr>
			<th style="min-width: 7em">型番</th>
			<th style="min-width: 7em">メーカ</th>
			<th style="min-width: 8em">入手先</th>
			<th style="min-width: 2em">総合</th>
			<th style="min-width: 2em">HL条件</th>
			<th style="min-width: 2em">DCHG出力</th>
			<th style="min-width: 2em">2DD</th>
			<th style="min-width: 2em">VFO無効</th>
			<th style="min-width: 2em">LED点灯</th>
			<th>備考・特徴等</th>
		</tr>
		<tr>
			<!-- 型番 -->		<td>FD1155D</td>
			<!-- メーカ -->		<td>日本電気</td>
			<!-- 入手先 -->		<td>外付けFDユニット<br>日本電気 PC-FD512</td>
			<!-- 総合結果 -->	<td>○</td>
			<!-- HL条件 -->		<td>○</td>
			<!-- DCHG出力 -->	<td>○</td>
			<!-- 2DD -->		<td>○</td>
			<!-- VFO無効 -->	<td>○</td>
			<!-- LED点灯 -->	<td>？</td>
			<!-- 備考 -->		<td>日本電気系のドライブとしては、VFO無し版のFD-1155Cと並んで超鉄板</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>FD1158C</td>
			<!-- メーカ -->		<td>日本電気</td>
			<!-- 入手先 -->		<td>日本電気 PC-9801FX</td>
			<!-- 総合結果 -->	<td>×</td>
			<!-- HL条件 -->		<td>×</td>
			<!-- DCHG出力 -->	<td>×</td>
			<!-- 2DD -->		<td>×</td>
			<!-- VFO無効 -->	<td>－</td>
			<!-- LED点灯 -->	<td>？</td>
			<!-- 備考 -->		<td>薄型・プッシュボタンエジェクト式。華奢</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>FD1158D</td>
			<!-- メーカ -->		<td>日本電気</td>
			<!-- 入手先 -->		<td>日本電気 PC-9801FA</td>
			<!-- 総合結果 -->	<td>×</td>
			<!-- HL条件 -->		<td>×</td>
			<!-- DCHG出力 -->	<td>×</td>
			<!-- 2DD -->		<td>×</td>
			<!-- VFO無効 -->	<td>×</td>
			<!-- LED点灯 -->	<td>？</td>
			<!-- 備考 -->		<td>上記のVFO有り版。なぜかFAとFX/FS間ではVFO有無が違う…。</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>YD-380B-1714B00WF</td>
			<!-- メーカ -->		<td>Y-E DATA</td>
			<!-- 入手先 -->		<td>外付けFDユニット<br>富士通 FMFD-521</td>
			<!-- 総合結果 -->	<td>△</td>
			<!-- HL条件 -->		<td>○</td>
			<!-- DCHG出力 -->	<td>×</td>
			<!-- 2DD -->		<td>？</td>
			<!-- VFO無効 -->	<td>－</td>
			<!-- LED点灯 -->	<td>○</td>
			<!-- 備考 -->		<td>富士通機の2HDドライブとして採用実績多数。挿入口付近のデッパリが特徴的。</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>JU-595H-232</td>
			<!-- メーカ -->		<td>松下通信工業</td>
			<!-- 入手先 -->		<td>富士通 FMR-50FD</td>
			<!-- 総合結果 -->	<td>△</td>
			<!-- HL条件 -->		<td>○</td>
			<!-- DCHG出力 -->	<td>×</td>
			<!-- 2DD -->		<td>○</td>
			<!-- VFO無効 -->	<td>－</td>
			<!-- LED点灯 -->	<td>○</td>
			<!-- 備考 -->		<td>FMR系では50の初代モデルにのみ搭載? 設定可能な項目が非常に多くて便利なのにDISK CHANGEだけは出せない…。</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>FD-55GFR-7XXX<br>(枝番失念)</td>
			<!-- メーカ -->		<td>TEAC</td>
			<!-- 入手先 -->		<td>新品(当時の秋葉TWO-TOP)</td>
			<!-- 総合結果 -->	<td>○</td>
			<!-- HL条件 -->		<td>－</td>
			<!-- DCHG出力 -->	<td>○</td>
			<!-- 2DD -->		<td>○</td>
			<!-- VFO無効 -->	<td>－</td>
			<!-- LED点灯 -->	<td>○</td>
			<!-- 備考 -->		<td>最初からAT互換機用なので動作は完璧。但し、ありとあらゆるメカが省略済(泣</td>
		</tr>
		<tr>
			<!-- 型番 -->		<td>FD-55GFR-351</td>
			<!-- メーカ -->		<td>TEAC</td>
			<!-- 入手先 -->		<td>確か日本電気 PC-8801MA</td>
			<!-- 総合結果 -->	<td>△</td>
			<!-- HL条件 -->		<td>○</td>
			<!-- DCHG出力 -->	<td>×</td>
			<!-- 2DD -->		<td>？</td>
			<!-- VFO無効 -->	<td>－</td>
			<!-- LED点灯 -->	<td>○</td>
			<!-- 備考 -->		<td>8bitマシンでの採用例多数だが、この枝番は特殊モデルのよう。アクセスランプが2色になっていて、2HD時に緑、2D時に赤</td>
		</tr>
	</table>
</div>


<h2>各ドライブ毎の細かい説明、及びリザルト</h2>
<div class="block">
	<p>試したドライブの詳細を、以下から説明していきます。</p>

	<h3>FD1155D</h3>
	<div class="block">
		<p>PC-9800シリーズの黄金時代によく使われていたドライブです(VM～DAの世代まで。FA以降は、後述するFD1158C/Dです)。
		その他大勢の機種に比べると随分と数が出たと思われますので、ドライブ(もしくはこれを積んでいる98本体)を手に入れる難易度は格段に低いのではないかと思います。但し、RA/RX以降に搭載のものは、本体全面カバーとドライブのベゼルが一体化しているので、AT互換機に移植すると悲しい見栄えになってしまいます(うちのPC-FD512搭載品もそうなります…)。</p>
		
		<p>一つ有名なトラブルとして、「ヘッドの磁気シールドが脱落してディスクが入らなくなる」というものがあります。
		この磁気シールドを支える導電性のスポンジが劣化して落ちてくるのが原因なのですが、
		別途基板を覆う金属のカバーが付いているモデルでは、別にこのシールドが無くても動作に影響は無さそうです(少なくとももうちの環境では)。
		カバーが無いモデルでは、導電性のスポンジを新たに買って修理した方が良いかもしれません。</p>
		
		<p>肝心の動作ですが、以前試したときの記憶では、DISK CHANGEも含めた動作は全く問題なく、あっさり動作しました。ただ、アクセスランプが点いたか点かなかったか、ちょっと記憶が曖昧です。尚、FD1157DやFD1157CやFD1155Cなども同様に使うことができるそうです。</p>
		
		<p>これらのドライブはLEDの件を除けば動作の確実性が高く、またドライブ自体も前述の磁気シールドの件以外はすこぶる頑丈で入手もしやすいので、
		もし新規にドライブを求めようとするのであればおすすめです。</p>

		<p>他所様からかき集めた情報を元に、うまくいった設定を掲載しますので、挑戦しようという方はどうぞ。
		尚、手持ちのドライブは「1991/9製 P/N=134-500207-818-0」のものです。基板サイズがかなり小さく、磁気シールドがあるタイプとなります。</p>

		<p>複数選択式の場合、表中で指定したシルクの箇所をショートし、他はオープンとします。括弧付きの項目はパターンだけのものです。
		金属カバーで基板が覆われている機体の場合、その裏にパターンだけの項目が隠れていることがありますのでご注意下さい。</p>

		<table>
			<tr>	<th style="min-width: 7em">ジャンパ</th>
										<th style="min-width: 5em">98設定</th>		
															<th style="min-width: 5em">AT設定</th>		
																				<th>説明</th>	<th>備考</th></tr>
			<tr>	<th>DEN(1～3)</th>	<td>1</td>			<td>1</td>			<td>2番ピン(DENSITY SELECT信号)の動作設定。<br>1=アサートで2DD、2=アサートで2HD、3=2HD固定、全てオープン=2DD固定</td>	<td></td></tr>
			<tr>	<th>HDE(1/2)</th>	<td>2</td>			<td>1</td>			<td>2DDモード時の回転数選択。<br>1=300rpm、2=360rpm</td>	<td>データレート300kbpsでアクセスする場合は2にする</td></tr>
			<tr>	<th>RD(1/2)</th>	<td>機種依存</td>	<td>1</td>			<td>FDD側VFO回路の動作設定。<br>1=VFO無効、2=VFO有効</td>	<td>98の場合、機種によってVFO回路をどちらに持つか異なる(外付けの場合は必ずFDD側の回路を使う)。</td></tr>
			<tr>	<th>USE(1～2)</th>	<td>1</td>			<td>2</td>			<td>4番ピンの機能選択。<br>1=HEAD LOAD信号、2=IN USE信号<br></td>	<td>AT互換機では本来NCだが、仕方ないのでIN USE信号としておく。</td></tr>
			<tr>	<th>MON(1～3)</th>	<td>1</td>			<td>3</td>			<td>モータオン条件設定。<br>1=DRIVE SELECT信号、2=HEAD LOAD信号、3=MOTOR ON信号</td>	<td></td></tr>
			<tr>	<th>DX(0～3)</th>	<td>任意</td>		<td>常に1</td>		<td>ドライブ番号の設定</td>	<td></td></tr>
			<tr>	<th>(MX)</th>		<td>オープン</td>	<td>オープン</td>	<td>多分Multiplex設定(ショートで全てのDSを自身の選択とみなす)</td>	<td></td></tr>
			<tr>	<th>VC</th>			<td>ショート</td>	<td>ショート</td>	<td>プルアップ抵抗設定? ショートで有効</td>	<td>設定例を見ると、バス上の全ドライブでショートしてる例が多い。…ということは、そんなに抵抗値が低くないのか?</td></tr>
			<tr>	<th>DCG(1/2)</th>	<td>1</td>			<td>2</td>			<td>34ピン出力設定。1 = Ready、2 = Disk Change</td>	<td></td></tr>
			<tr>	<th>(TST)</th>		<td>オープン</td>	<td>オープン</td>	<td>テストピン。<b>初期値から変更しないこと</b></td>	<td></td></tr>
			<tr>	<th>(LM1)(0/1)</th>	<td>オープン</td>	<td>オープン</td>	<td>???</td>	<td>アクセスランプ絡み?</td></tr>
			<tr>	<th>(LM2)(0/1)</th>	<td>オープン</td>	<td>オープン</td>	<td>???</td>	<td>アクセスランプ絡み?</td></tr>
			<tr>	<th>(MI)</th>		<td>オープン</td>	<td>オープン</td>	<td>???</td>	<td></td></tr>
			<tr>	<th>(VS)</th>		<td>オープン</td>	<td>オープン</td>	<td>???</td>	<td>VCがプルアップ(Vccへ吊る)とすれば、Vssとも読めるので「プルダウン抵抗設定」? だとしたら触るべきではない。</td></tr>
		</table>
		
		<p>尚、詳しい情報が欲しい場合は他所様を見てみる事をお勧めします。FD1155Dで検索するとたくさん出てきます(うちでは98に繋いで現役の為、あんまり細かく試していませんので…)。</p>

		<div class="memo">
			<div class="memo_blk1">外付けFDDの寿命</div>
			<div class="memo_blk2">
			<p>ちょっと脱線します。手元のFD1155Dが実装されていた外付けFDDユニットのPC-FD512ですが、電源ユニットのケミコンが原因で、電源基板が盛大に腐食してしまいました…。</p>
			<p>幸い、ドライブの方は全くもって無事だったので、現在は元々の電源スペースに5V/2Aと12V/1Aの小型スイッチング式ACアダプタを据えつけることで復旧できました。電源ランプが楽しい点滅を始めたら危篤ですので、何かしらの対策を行うことをおすすめします(各ドライブの消費電力は、+12V=3W、+5V=2Wです)。参考まで。</p></div>
		</div>
		
		<div class="memo">
			<div class="memo_blk1">ベゼルがないFDD</div>
			<div class="memo_blk2">
			<p>さらに脱線します。ふと思ったのですが、いっそのこと、元のベゼルから寸法を起こした代替ベゼルを、3Dプリンタとかで作っちゃえばいいんじゃね? と思いました。どうせ数が出るもんでもないでしょうし…。</p>
			<p>ただ、テカテカのABSとかで仕上がったらベゼル無しよりもダサさが増す可能性がありますが…。梨目とかまで再現できるようになったとしたら、黄ばんで脆くなったオールドマシンの筐体復活とか、既に破損・無くしたパーツの復活とか、色々面白い方向にも使い道が広がるかもしれませんねぇ。</p>
			<p>…と書いたところで、<a href="http://shiuntenlos.ie-yasu.com/98ma0070.htm">試運転さんのところにも同じような話を見つけました</a>。こちらも参考にして頂くと良いかもしれません。</div>
		</div>
		
	</div>

	<h3>FD1158C</h3>
	<div class="block">
		<p>	PC9801FS/FXから採用された、プッシュボタンエジェクト機構採用ドライブです。
		PC-9821シリーズやBX等の5インチモデルでも、VFO無し版であれば、おそらくこれと同じドライブが載っています。
		一般的な5インチ内蔵ドライブに比べて厚さが半分になっており、また、内部の構造もヘッドの移動にリードスクリューが使われていたり、ヘッドロード機構が省略(ディスク挿入時は常にヘッドロード)されていたりと、全体的に3.5インチドライブみたいな作りになっています(接続もカードエッジではなく、ピンヘッダですし)。</p>
		
		<p>そういった小型化が影響しているのかわかりませんが、細かい設定を行う為のジャンパピン等が存在しません。
		このため、改造したり、外部で必要な信号を補ったりする以外に、AT互換機で使う方法は無さそうです。</p>
		
		<p>ジャンパピンについては、DS選択用が4つと、他が2つだけです。</p>
		<p>現在既にドライブが手元にありませんので詳細はうろ覚えですが、確かVCのジャンパを弄ったところ、ヘッドが暴走して他の媒体を読めなくなってしまいました。そうなるとヘッドを微調整する以外に復旧の手だてがなくなりますのでご注意下さい。特に他の動作が変わった訳でも無いので、DS選択用のジャンパ以外は触らない方が賢明です。</p>

		<p>さらに、このドライブには悪名高いハズレの四級塩電解コンデンサが使われているようで、そのままだとドライアップや液漏れで動作不良を起こす可能性が高いとされています。</p>
		
		<p>…といったように、元々持っているドライブを流用しようとするならともかく、AT互換機用としてわざわざ購入するにはあまりにも爆弾が多すぎるドライブですので、大人しくFD1155D等を使う方がよろしいかと思います。</p>

		<div class="memo">
			<div class="memo_blk1">HEAD LOAD信号の作り方</div>
			<div class="memo_blk2">
			<p>このドライブを使うにあたって、一番ネックになるのはおそらくこの信号です(READY信号の件を除けば)。</p>
			<p>実のところ、ただ読み書きするだけであれば簡単に作ることができます。このドライブに対するDRIVR SELECT信号とMOTOR ON信号をAND(両方アサートされたときにアサート)すれば良いです。他のドライブの心配がなければ、4ピンをGNDに直結でもOKかもしれません。</p>
			</div>
		</div>
	</div>

	<h3>FD1158D</h3>
	<div class="block">
		<p>FD1158CのVFO有り版となります。PC-9801FAに採用されていますが、他で使われているかどうかは知りません。ただの機能違い版かと思いきや、確かFD1158Cとは基板の雰囲気がまるで違った記憶があるのですが、やはりどちらも最近見ていないので虚ろ覚えです(ぇ</p>

		<p>基本的にはFD1158Cの説明に準じますので、詳細はそちらを参照下さい。</p>
	</div>

	<h3>YD-380B-1714B00WF</h3>
	<div class="block">
		<p>富士通系の古いカタログ等を見てると良く出くわすデザインのドライブです(パソコンに限らず、OASYS等でも)。私自身はFM TOWNS用の外付けミニFDユニットに入っていたものを試しました。</p>
		<p>結論から書くと、他に成功された方もおられるようですが、自分の環境では、ジャンパだけを弄った範囲ではDISK CHANGE信号が出せませんでした。
		パターンになっているところの設定を弄れば、もう少しなんとかなるのかもしれませんが、
		そもそもドライブのデータシートが全く見つからない上に、同社の他のドライブ(YD-702D-6639D等)のジャンパとも
		全く一致しないシルクが多いため、今のところ深追いできていない状況です。</p>
		
		<p>これ以外は問題ありませんでしたので、Windows上で<a href="#oredrv">拙作ドライバ</a>と使う場合はOKです。…というか、FMR系との他の違いといったらLEDの点灯条件だけなので、当然といえば当然ですね。</p>
		<p>参考として、ジャンパ/機能選択と思われる空きパターンと、FMR用の設定、AT互換機用に近い設定(ショート箇所)をまとめておきます。
		名称の括弧付きはパターンのみです(基板PN:128213-02 REV.B)。</p>
		
		<table>
			<tr>	<th style="min-width: 7em">ジャンパ</th>
											<th style="min-width: 5em">FMT設定</th>		
																<th style="min-width: 5em">AT設定</th>		
																					<th>説明</th><th>備考</th></tr>
			<tr>	<th>DS0～DS3</th>		<td>任意</td>		<td>DS1</td>		<td>ドライブ番号選択</td><td></td></tr>
			<tr>	<th>HS、HM/(HH)</th>	<td>HS</td>			<td>HS</td>			<td>ヘッドロード条件選択。HS=ドライブセレクト、HM=モータオン、HH=ヘッドロード信号を使用?</td><td></td></tr>
			<tr>	<th>(HD)、INU、HL</th>	<td>INU</td>		<td>INU</td>		<td>4番ピンの用途選択。HD=HIGH DENSITY信号出力?、INU=IN USE信号、HL=HEAD LOAD信号</td><td></td></tr>
			<tr>	<th>TD</th>				<td>ショート</td>	<td>ショート</td>	<td>?</td><td></td></tr>
			<tr>	<th>MR</th>				<td>ショート</td>	<td>ショート</td>	<td>?</td><td></td></tr>
			<tr>	<th>(SF)</th>			<td>オープン</td>	<td>オープン</td>	<td>?</td><td></td></tr>
			<tr>	<th>(OB)/(OA)</th>		<td>オープン</td>	<td>オープン</td>	<td>?</td><td></td></tr>
			<tr>	<th>(LE)、LA、LB</th>	<td>LA</td>			<td>LB</td>			<td>LEDの点灯条件変更??。LAでDS遷移時のIN USE信号ラッチ、LBはヘッドロード連動???</td><td></td></tr>
			<tr>	<th>(DA)</th>			<td>オープン</td>	<td>オープン</td>	<td>?</td><td></td></tr>
			<tr>	<th>(M2)、(M1)/(M3)</th><td>オープン</td>	<td>オープン</td>	<td>?</td><td></td></tr>
		</table>
		
		<p>尚、基板上のDIPスイッチを全部ONにすると終端抵抗有効、OFFで無効となります。</p>
		
		<div class="memo">
			<div class="memo_blk1">ケミコンの香り</div>
			<div class="memo_blk2">
			<p>ちょっと脱線します。このドライブの基板上に10uF/50Vの電解コンデンサが2つ、電源コネクタ付近に載っているのですが、
		手元の機体だと、この周囲からちょっとアレげな香りがしています…。尤も、周囲は液漏れしたように見えませんし、外付けFDD自体のI/F基板からも同じ香りがしているので、もしかしたらそちらから移ってきただけかもしれませんが…。もし危険を感じた方がいらっしゃいましたら交換をおすすめします…。</p></div>
		</div>
	</div>

	<h3>JU-595H-232</h3>
	<div class="block">
		<p>FMR-50FDから抜き出したドライブですが、その次のモデル(FX/HX等)以降、FMR上で彼の姿を見たものはありません(しかも同時デビューの60FD/HDはYD-380Bみたいだし…なんで50系だけ?)。そんな珍しいドライブですが、松下通信工業製のドライブ自体は海外だとそれなりに出回っていたようで、eBay等では似たようなデザインのものをよく見かけます。特に、JU-475-2というドライブは、このドライブと制御基板の構成まで殆ど同じように見えます(ジャンパの位置まで全く同じです。もはや間違い探しの領域ですね…)。</p>
		<p>そういったこともあって、幅広い使われ方が想定されていたのか、ジャンパの設定は大変充実しています。しかし、なぜかうちのドライブでは肝心のDISK CHANGE信号が出せません…。それっぽいシルクもあるのですが、設定してみても34ピンがアサートされっぱなしで反応ナシです。</p>
		<p>仕方ないので巷に出回っているJU-475-2の写真と見比べてみたのですが、どうも手持ちのドライブではセンサっぽいものが1つ省略されているように見えます。インデックスホールのセンサ付近・ドア軸の終端付近にネジ穴があるのですが、JU-475-2の写真だと、ここに何かセンサみたいなのが付いているようです。もし松下製のドライブを新規に購入しようとされる場合は、このあたりを注意して頂くと良いかもしれません。</p>
		<p>ここではAT互換機用に近い設定を掲載します。尚、随分前に試したっきりでしたので、FMR用の設定は行方不明です…。各項目の説明は、自分で実験した結果と元々の設定、DELLのサポートページで見つかったJU-475-3の設定などから推測したものです。</p>

		<table>
			<tr><th style="min-width: 7em">ジャンパ</th>
								<th style="min-width: 5em">AT設定</th>
													<th>説明</th></tr>
			<tr><th>DS/MX</th>	<td>DS側</td>		<td>DS:ドライブセレクトに従う。<br>MX:全てのドライブセレクトを自身の選択と見なす。</td></tr>
			<tr><th>DS</th>		<td>2</td>			<td>ドライブセレクトの番号。AT互換機では無条件に2。</td></tr>
			<tr><th>(HH)</th>	<td>ショート</td>			<td></td></tr>
			<tr><th>(TM)</th>	<td>オープン?</td>	<td>ショートで終端抵抗有効のようだが、FMR用のものでは両ドライブともオープン。その代わり、片方のドライブにはソケットに150Ωが差さっていたので、それに準ずれば良いかと。</td></tr>

			<tr><th>AT/AX</th>	<td>AT側</td>		<td>2HD/2DD切り替えタイミングの設定。AT側だと常時設定変更を受け付ける。<br>AXだとドライブセレクトの立ち下がり時に設定変更を受け付ける。</td></tr>
			<tr><th>BX CX</th>	<td>BX側</td>		<td>回転数切り替え設定。BXだと2DD/2HD変更時に回転数を切り替える。<br>CX側では、何がなんでも(1Mがショートされていても)常に360rpmの模様。</td></tr>
			<tr><th>(1M)</th>	<td>オープン</td>	<td>ショートで2DD固定モード</td></tr>

			<tr><th>IRD</th>	<td>オープン</td>	<td>Internal ReaDyと読めるが、それをどうしろと??? FMR-50FDではショートさせているが、外人さんの情報ではオープン設定ばかりである。</td></tr>

			<tr><th>(GX)</th>	<td>ショート</td>	<td>READ DATA出力のマスク機能のよう。ショートで、シーク中等にデータが出なくなる?</td></tr>

			<tr><th>(FX)</th>	<td>オープン</td>	<td></td></tr>
			<tr><th>(DR)</th>	<td>ショート</td>	<td></td></tr>

			<tr><th>DO</th>		<td>オープン</td>	<td>34ピンの挙動設定。DOOR OPEN(DISK OUT?)と読めるので、<br>ディスク未挿入時にアサート?</td></tr>
			<tr><th>DC</th>		<td>オープン</td>	<td>34ピンの挙動設定。34ピンにDISK CHANGE信号を出力。<br>JU-475-2だと、これがショートされている写真が多い</td></tr>
			<tr><th>LR</th>		<td>ショート</td>	<td>34ピンの挙動設定。名前からしてREADY信号の変形版(ラッチ付き?)だろうか…。<br>34ピンを常にネゲート?<br>DISK CHANGE信号が出力されない場合はこちらで代用。</td></tr>
			<tr><th>RD</th>		<td>オープン</td>	<td>34ピンの挙動設定。34ピンにREADY信号を出力。</td></tr>

			<tr><th>HM</th>		<td>オープン</td>	<td>モータオン条件 + MOTOR ON信号 でヘッドロード。</td></tr>
			<tr><th>HS</th>		<td>ショート</td>	<td>モータオン条件 + DRIVE SELECT信号 でヘッドロード。</td></tr>
			<tr><th>HL</th>		<td>オープン</td>	<td>モータオン条件 + HEAD LOAD信号(4ピン) でヘッドロード。</td></tr>

			<tr><th>MS</th>		<td>オープン</td>	<td>DRIVE SELECT信号 でモータオン。</td></tr>
			<tr><th>MM</th>		<td>ショート</td>	<td>MOTOR ON信号 でモータオン。</td></tr>

			<tr><th>HA</th>		<td>オープン</td>	<td>モータオン条件 + ドライブセレクト + ヘッドロード条件 でランプ点灯。</td></tr>
			<tr><th>OA</th>		<td>オープン</td>	<td>モータオン条件 + 自分以外へのドライブセレクト でランプ点灯。</td></tr>
			<tr><th>DA</th>		<td>ショート</td>	<td>モータオン条件 + ドライブセレクト でランプ点灯。</td></tr>
			<tr><th>UA</th>		<td>オープン</td>	<td>IN USE信号(4ピン)の状態(下記)に応じて ランプ点灯。</td></tr>

			<tr><th>DD</th>		<td>オープン</td>	<td>34ピンリセット条件。ドライブセレクトの変化で遷移。</td></tr>
			<tr><th>IX</th>		<td>ショート</td>	<td>34ピンリセット条件。INDEX信号の変化で遷移。READY信号使用時設定推奨。</td></tr>
			<tr><th>SP</th>		<td>オープン</td>	<td>34ピンリセット条件。STEP信号の変化で遷移。DISK CHANGE信号使用時設定推奨。</td></tr>

			<tr><th>(NO/AR)</th><td>AR側</td><td>	</td></tr>
			<tr><th>(+WP)</th>	<td>ショート</td>	<td></td></tr>
			<tr><th>(MSE)</th>	<td>ショート</td>	<td></td></tr>
			<tr><th>(JX)</th>	<td>オープン</td>	<td></td></tr>
			<tr><th>(44/64)</th><td>44側</td>		<td></td></tr>
			<tr><th>(PR)</th>	<td>オープン</td>	<td></td></tr>
			<tr><th>(MN)</th>	<td>ショート</td>	<td></td></tr>
		</table>
	</div>

	<h3>FD-55GFR-7XXX</h3>
	<div class="block">
		<p>2000年代にも新品で購入できた数少ないドライブです(2007/02/18当時に確認済。2010/01/27時点ではもう流通してなさそうでした)。秋葉のTWO-TOP本店で購入したものです(今はBUY MORE秋葉原本店になっています。そういえばこの場所、TWO-TOPの前は富士通のショールームだったんですよねぇ…懐かしいなぁ)。</p>
		<p>フロントマスクこそ、PC-8801シリーズをお使いの方々には懐かしいであろう昔ながらのTEAC顔なのですが(何)、メカ周りに目を向けると<b>衝撃的な程スッカラカン</b>です…。ヘッドロード機構が省略されているのは、まぁしょうがないと思います(つまり、ディスクが入っている間は常にディスクに接触しています)。しかし、<b>エジェクト機構まで省略するのはどういう神経なんでしょう</b>。いや、実害は無いんですが、ディスクを差す→「カチっ」とも言わず、ディスクを抜くときも、レバーを上げる→ディスクが飛び出てこない→自力で奥から引っ張りだす…等、<b>ものすごくダサい</b>です。幸い、他のFD-55GFRからエジェクト機構の移植はできますので、気になる方はご検討下さい(ちなみに、ヘッドロード機構の移植は無理そうでした)。その他の外観上の特徴としては、アクセスランプが緑になっています。</p>
		<p>当然、最初からAT互換機に繋ぐことを前提に売られていた代物ですので、初期設定のままで使用することが可能です。「絶対に失敗しない」という意味では一番おすすめできる選択肢です(7000番台の中古流通量がどれくらいなのかが気になりますが…)。ということで、ジャンパの設定については省略します。ただ、もしAT互換機以外に取り付けたい場合等で、ジャンパの設定を詳しく見たい方は、かつてメーカが公開していたデータシートを参照下さい。現在は削除されていますが、幸い<A href="http://web.archive.org/web/*/http://www.teac.com/DSPD/pdf/5fd0050a.pdf">キャッシュ</A>が残っていますので、こちらからどうぞ。</p>
	</div>
	
	<h3>FD-55GFR-351</h3>
	<div class="block">
		<p>こちらは前述のものよりもっと昔のFD-55GFRでして、PC-8801MAに搭載されていたドライブです。ヘッドロード機構やエジェクト機構が搭載されていますので、メカ的には安心のラインナップです。また、アクセスランプが2色タイプになっていて、2HD時は赤、2D時は緑になるのもお洒落です。ただ、オリジナルのフロントマスクは88の筐体デザインに合わせて少し寸法が大きいようで、そのままではAT互換機の5インチベイに納まりません(上側が干渉する)ので注意して下さい(7000番台からフロントを移植することは可能です。赤ランプが見づらくなりますが…)。</p>
		<p>肝心の動作ですが、手元の環境ではまだDISK CHANGE信号を出せていません。というのも、FD-55GFRは枝番が違うと制御基板は全く別物のようでして、7000番台とは設定項目/挙動が異なっているためです(さらに言うとヘッドやダイキャストまで微妙に違う形をしています)。ジャンパ自体は、<A href="http://web.archive.org/web/*/http://www.teac.com/DSPD/pdf/5fd0050a.pdf">前述のデータシート</A>にある-340等の図(前半の方)とだいたい同じなのですが、<b>困ったことにジャンパの図があるだけで、対応する説明が一切省略されております…</b>。また、手持ちのドライブではなぜか殆どの設定項目が「空きパターン / 0Ω半田付け」になっていて、設定変更が面倒臭いというのもあります(しかも、この基板にはヘッドのTRACK 00位置決め用の光センサが載っていますので、基板を外してピンヘッダを取り付けるのも億劫です)。</p>
		<p>…このようにTEACのドライブでは、いくら7000番台がAT互換機で使えるからといって、枝番も考慮せずに迂闊に手を出すと痛い目を見る可能性があるので注意が必要です(下手するとPART No.から見ないと、全然別物があたる可能性も…。3.5インチのFD-235HGとかもカオスなので…)。</p>
		<p>参考までに、こちらで試したAT互換機用に近い設定を掲載します。PC-8801用の設定は、確かREADY信号を使うかどうか以外同じだったはず(0Ωを付け替えた形跡がない)ので省略します。</p>
		<table>
			<tr><th style="min-width: 7em">ジャンパ</th>
								<th style="min-width: 5em">AT設定</th>
														<th>説明</th></tr>
			<tr><th>I/II/(IS)</th>	<td>I側</td>		<td>実際のシルクはローマ数字(1/2/1Sと読む)。2ピンによる回転数切替動作。この設定だと、2ピンアサートで300rpm、ネゲートで360rpm。</td></tr>
			<tr><th>(IL)</th>		<td>オープン</td>	<td>名前からしてLED関係っぽいが???</td></tr>
			<tr><th>(U1～0)</th>	<td>U1</td>			<td>LEDの点灯条件っぽい。他の資料と一致しない(U1だけショートの設定は他に記載が無い)が、8801の設定から変更していない。</td></tr>
			<tr><th>(D0～3)</th>	<td>D1</td>			<td>ドライブセレクトの番号。AT互換機では無条件に1。</td></tr>
			<tr><th>(LG)</th>		<td>オープン</td>	<td>2ピンの論理設定。ショートで反転(アサートで2HDとなる)。</td></tr>
			<tr><th>(E2)</th>		<td>ショート</td>	<td>シーク動作中にINDEX信号やREAD DATA信号を出すかどうか。ショートで出力。</td></tr>
			<tr><th>(DLE)</th>		<td>オープン</td>	<td></td></tr>
			<tr><th>(HS)</th>		<td>ショート</td>	<td>ヘッドロード条件? ドライブセレクトでヘッドロード。</td></tr>
			<tr><th>(HL)</th>		<td>オープン</td>	<td>ヘッドロード条件? HEAD LOAD信号でヘッドロード。</td></tr>
			<tr><th>(IU)</th>		<td>オープン</td>	<td>ショートでIN USE信号を使う?</td></tr>
			<tr><th>(ML)</th>		<td>オープン</td>	<td>モータオン条件。オープンでMOTOR ON信号、ショートでMOTOR ON + LED点灯条件??</td></tr>
			<tr><th>(RY)</th>		<td>オープン</td>	<td>34ピンの出力選択。ショートでREADY信号。8801ではショート。</td></tr>
			<tr><th>(DC2/DC1)</th>	<td>DC2?</td>		<td>34ピンの出力選択? DC2は唯一枝番340のデータシートに記載されている設定だが、手持ちの機体では正しいDISK CHANGE信号が得られない。8801では全てオープン。</td></tr>
			<tr><th>(DC4/DC3)</th>	<td>オープン</td>	<td>34ピンの出力選択? つか、こんなに種類があるの?</td></tr>
			<tr><th>(FG)</th>		<td>(変更無し)</td>	<td>フレームGNDの処理。初期値から変更しないこと。</td></tr>
		</table>
		
		<p>尚、8801MA自体の仕様では「2HD/2D兼用」となっていて、2DDには言及がないようです。ドライブの型番の命名規則上FD-55GFR自体は2HD/2DDドライブではないかと思われるのですが(つまり、2D時は88側でステップ数を2倍にして対応しているのだろうと思うのですが)、実際に2DDとして使えたか記憶が曖昧なので、流用を考えている方はご注意下さい。また、手元のドライブはプルアップ抵抗が直付けされています(SIP集合抵抗1kΩ)。もしソケット型になっていれば、これに準ずる集合抵抗を差してやれば良さそうです。</p>
	</div>

</div>

<h2>Windows上でデータを読み書きするには</h2>
<div class="block">
	<p>ここまでで、とりあえずAT互換機とドライブの物理的な接続については解決しました。後はディスクにアクセスするだけなのですが…ここでも大きな問題があります。</p>
	<p>ご存じの方は多いと思いますが、フロッピィディスクは基本的にソフトセクタ方式なので、自前でフォーマットすることによってかなり自由な形式を作ることが可能です。例えば、トラック毎にセクタ数/セクタサイズ/記録方式が違っていたり、或いは同じトラック内に異なるサイズのセクタが混在していたりといったトンデモナイものまで扱えてしまいます。</p>
	<p>そういうメディアですので、じゃあWindowsではどういう風にディスクを認識しているのか…というと、<b>ディスク上の全てのトラックが同一のセクタ数・セクタサイズでフォーマットされていると仮定し、トラック0に対してフロッピィドライバが知っている(自力でフォーマットできる)ディスクフォーマットを片っ端から試していって、一致したらその形式とみなしてアクセスする</b>という、すげー悲しい方式となっています。まぁ、元々FATのディスクを扱うことしか考えていなさそうですし、他のストレージは今やLBAだったりするのが多いので、仕方ないところなのかもしれません。ここまでは諦めが付きますが、困ったことに、<b>日本でメジャーだった5インチ2HD(1024バイト/セクタ、8セクタ/トラック、154トラック/ディスク = 1.25MB)や5インチ2DDに関する定義が含まれていません</b>。つまり、いくら<b>FATフォーマットされた2HDディスクであっても、Windows標準ドライバでは読み書きできません</b>。これは致命的です。</p>
	
	<p>仕方ないので他の手段をとります。</p>
	<ul class="list">
		<li>こちらで作成したドライバを使う</li>
		<li>TOMCAT製の3.5インチ3モードFDDドライバを流用する</li>
		<li>他</li>
	</ul>
	<h3 id="oredrv">こちらで作成したドライバを使う</h3>
	<div class="block">
		<p>つまりはフォーマットの定義さえ増やしてやれば良い訳ですので、そういうドライバを作ってみました(1.2MB、1.25MB、720KB、640KBの定義を追加しています)。他にも、READY信号しか出ないドライブでも使えるようにしたり、一部FDC(スーパI/Oチップ)にて2ピンの制御に対応したりしています。もし必要であれば、<a href="./dev_hw.htm">こちら</a>からどうぞ。但し、32bit版しか作成していませんのでご注意下さい(そのうち親指ドライバみたいにソース公開にするかなぁ…)。</p>
		<p>但し、Windows 7上で使ってみるとエクスプローラ上からのフォーマットができないようです(多分メディアタイプの定数定義がいくつか消されたんでしょうね…)。コマンドプロンプトからのフォーマットはできましたので、必要であれば以下を参考にしてください。尚、Windows 2000上ではエクスプローラ上でもOKです。</p>
		<div class="memo">
		<pre class="memo_blk2">1.25MB(NEC)の場合:>format a: /t:77 /n:8
1.21MB(IBM)の場合:>format a: /t:80 /n:15
720KBの場合:      >format a: /t:80 /n:9
640KBの場合:      >format a: /t:80 /n:8</pre>
		</div>
	</div>
	
	<h3>TOMCAT製の3.5インチ3モードFDDドライバを流用する</h3>
	<div class="block">
		<p>TOMCAT製の3モードドライバには前述のフォーマットの定義が含まれていますのて、もし同社の制御に対応した3.5インチ3モードFDDを使うのであれば、5インチFDDを追加で繋ぐことで、こちらでも2HDフォーマット等を取り扱うことができるようになります(もちろん、基本的な動作は標準ドライバに準じていますので、34ピンにはDISK CHANGE信号が出ている必要があります)。但し、Windows 2000以降用のドライバだと上手く動作せず、NT4用のドライバを無理やり使う必要かありました。</p>
		<p>以下はWindows 2000で試したときのメモです。最近のWindowsでは、ドライバのストア周りで事情が変わっていますので上手くいかないかもしれません。</p>
		<p>具体的な手順としては、WINNT\SYSTEM32\DRIVERSにあるFDC.SYSをTOMCATのNT用ドライバ(FLOPPY.SYS)と置き換えればOKです。但し、Windows上で行っても、システムファイル保護の影響で、勝手に元のドライバに置き換わってしまうので、別のシステム等から置き換える必要かあります。</p>
		<p>尚、このNT4ドライバはPnP対応ではありませんので、休止状態やスタンバイ等に入ることはできなくなります。</p>
	</div>
	
	<h3>他</h3>
	<div class="block">
		<p>もしかすると、他にも同様のことを実現できるドライバがあるかもしれませんので、探してみるのも手です。</p>
		<div class="memo">
			<div class="memo_blk1">MS-DOSでの使い方</div>
			<div class="memo_blk2">
			<p>リニューアル前のページに書いていたことを、情報としてメモしておきます。</p>
			<p>こちらの場合も、標準では1.25MB等の形式には対応していませんので、追加でドライバをロードする必要があります。例えば、<A href="http://www.vector.co.jp/soft/dos/hardware/se000437.html">こちら</A>を組み込む事によって読み書きが可能になります(ドライブレターが増えますが…)。また、フォーマットなどに、自分は<A href="http://www.vector.co.jp/soft/dos/util/se004967.html">これ</A>を使っています。</p>
			<p>尚、あくまでもMS-DOSファイルを扱うための措置ですので、DISK BIOSを使うものやFDCを直接叩くようなソフトの場合は、そのソフトが対応していれば無関係です(後述するDITT.EXE等)。また、DISK BIOSは34ピンのDISK CHANGE信号を見ていますので、正しくドライブ側を設定しておく必要があります。</p></div>
		</div>
		<div class="memo">
			<div class="memo_blk1">Windows 9x系での使い方</div>
			<div class="memo_blk2">
			<p>こちらも情報としてメモしておきます。</p>
			<p>9x系は思いの外変わった動きをしていまして、特に何もせずに2HDのディスクを扱うかことが可能だったと記憶しています(32bitディスクドライバ使用時。2DDは確認していません)。但しフォーマットはできなかったはずですが、DOSに降りれば前述の手段で解決できます(TOMCATのドライバを使ってもOKです)。また、34ピンを見ていないようなので、READY信号しか出せないドライブでも使用可能です(この場合、DOSだとダメですが)。</p>
			<p>注意事項として、AT互換機用のWindows 9xを使ってフロッピィディスクにアクセスする場合、書き込み禁止にしていないとブートセクタが破壊される可能性があります。特に、<b>FMR/FM TOWNS系のディスクは格好の餌食で、一度でもアクセスするとブート不可能になってしまいます</b>。大事なものや特殊フォーマットのディスクを扱う場合は書き込み禁止にしたり、先に生贄を用意して様子を見るなりして十分気をつけて下さい。</p></div>
		</div>
	</div>
	
</div>

<h2>特殊なフォーマットのディスクを扱う</h2>
<div class="block">
	<p>先程は、MS-DOSで一般的なFATフォーマットのディスクをWindows上で扱う方法でした。</p>
	<p>しかし、Windows上ではかなり限定したディスクを扱うことしかできないということは説明した通りです。例えば、N88-DISK BASICのディスクや汎用機系のディスク、OASYS等のワープロのディスクは、そのままだと取り扱うことができません。「せめて直接FDCを叩きたいんだけど」と思うところですが、Windows標準FDCドライバのDeviceIoControlは一般のアプリから叩いても上手く動かなかったように記憶しています(確か、バッファ類をDMAが使えるメモリ空間(下位16MB)から確保しなければならず、下手すると青画面…)。一旦中間バッファで受けたり、或いは外部公開用のI/Fを新規に作り直せばOKかもしれませんが、結構骨の折れる作業です…。</p>
	<p>ということで、今回は別の手段をとります。つまり、そういうしがらみのない環境でディスクイメージの作成・書き戻しを行い、得られたイメージをWindows上で読むなり書くなりする…というスタンスです。</p>
	<p>例えば、AT互換機用のMS-DOSで動作するディスクイメージ作成ソフトとして、DITT.EXEというものがあります。これでD88形式のディスクイメージを作成すれば、CHRN等の情報も含めてバックアップしたり書き戻したりすることが可能です。DITTは<a href="http://retropc.net/cisc/m88/">こちらのページ</a>から辿って行って、その他の所からダウンロードできます。</p>
	<p>ただ、さすがに、今や本物のMS-DOSを持っている方は少ないでしょうし、あっても、HDDの大容量化やFATが使われなくなったこともあって、ディスクイメージを作成する場所に困ってしまうと思います。そこで、FreeDOSを使ってみるのは如何かと提案しておきます(私自身はまだ試していません)。USBメモリからブートできるそうなので、もしUSBメモリ上にデータが保存できるのであれば、シングルドライブ運用でも目的は達成できそうです(NTFSは扱えないそうなので、最近の機体ではHDDは扱えないと思った方が良さそうです)。</p>
	<p>一旦ディスクイメージとして取り込んでしまえば、後はバイナリエディタなり、ツールを作るなりして所望のデータを読み書きすることは可能かと思います(ぇ D88形式については、<a href="http://www.gnu-darwin.org/www001/src/ports/emulators/quasi88/work/quasi88-0.6.3/document/FORMAT.TXT">こちら</a>に参考となる資料がありましたのでどうぞ。</p>
	
	<div class="memo">
		<div class="memo_blk1">FDCを直接叩くアプリ</div>
		<div class="memo_blk2">
		<p>思いついたのでメモ。FDCにはPIOモードがあるので、<b>FDCドライバを無効化した状態であれば</b>、GIVEIO.SYSと組み合わせてFDC直叩きのディスクアクセスアプリが作れるかもしれません。データの取りこぼしが若干怖いですが、プロセスの優先度最高にすれば回避できるかも? 物好きな方は試してみると良いと思います。ちなみに、AT互換機のI/Oポート仕様等は<a href="http://www.oadg.or.jp/">OADGのサイト</a>から無料で…って<b>いつのまに仕様書が有料になってんだ?オイ!!</b> FDC周りだけであれば<a href="http://community.osdev.info/index.php?(FDC)765A">こちら</a>でも事足ります。</p></div>
	</div>
	
	<div class="memo">
		<div class="memo_blk1">FM(周波数変調)</div>
		<div class="memo_blk2">
		<p>フロッピィディスクの記録形式にはFM(単密度)とMFM(倍密度)の2種類があります。現在では一般的にMFMを使いますが、OASYSの文書ディスクや汎用機系のディスクではFM変調で記録されているセクタが存在します。DITT自体はFMのセクタを扱えたと記憶していますが、そもそもFDC(スーパI/Oチップ)の実装レベルでFM変調が扱えないものが存在するそうです。気になる方は、予めスーパI/Oチップのデータシートを確認されると良いかもしれません。</p></div>
	</div>
	
</div>

<h2 id="trouble">トラブルシューティング</h2>
<div class="block">
	<p>正しく動作しない場合にありがちな現象について、Windows NT系で標準ドライバを使ったときの挙動からまとめておきたいと思います。尚、検証の為には、予め「読める」ディスクを用意しておく必要があるのでご注意ください(つまり、2HC/2Dフォーマットのディスクです)。<a href="#oredrv">拙作ドライバ</a>を使った場合も、34ピン周りの動作を除いて概ね同じてすが、こちらは2HD/2DDフォーマットのものでもOKです。とりあえず、<b>ケーブルの向きとか、電源コネクタがとかは問題ない前提で…</b>。</p>
	
	<h3>読み書きできるがアクセスランプがつかない</h3>
	<div class="block">
		<p>アクセスランプの点灯条件が間違っています。IN USE信号が使えるドライブでは、他の条件よりもそちらが優先されている可能性が高いです。IN USE信号を使わないように設定するか、IN USE以外の点灯条件を優先するように変更してみて下さい(例えば、MOTOR ON * DRIVE SELECT)。</p>
	</div>
	
	<h3>ディスクをセットしているのに、シーク音のあと「ディスクをセットしろ」と言われる</h3>
	<div class="block">
		<p>34ピンにDISK CHANGE信号が出ていません。特に、READY信号が出ている場合はこのパターンになります(逆に、ディスクを抜いた状態でアクセスすると、アクセスしたプログラムが反応しなくなり、暫くしてからエラーとなる)。DISK CHANGE信号が正しく出力されるように変更してみて下さい。又は、<a href="#oredrv">拙作ドライバ</a>を使う逃げ道もあります。</p>
	</div>
	<h3>ディスクを交換しても、前のディスクの中身が表示される</h3>
	<div class="block">
		<p>34ピンにDISK CHANGE信号が出ていません。特に、34ピンが常にネゲートされているとこのパターンになります(例えば、信号の割当がないドライブ等)。DISK CHANGE信号が正しく出力されるように変更してみて下さい。</p>
	</div>
	<h3>アクセス時にスピンドルモータは回るが、読み書きできない</h3>
	<div class="block">
		<p>アクセスランプが付かなかったり、ヘッドロード音がしない場合であれば、ドライブセレクト設定かヘッドロード条件が間違っています。特に、HEAD LOAD信号を別途使うことができるドライブであれば、DRIVE SELECT * MOTOR ONだけでヘッドロードするように設定して下さい。ドライブ番号は、A/Bどちらに使う場合も2番目(0～3であれば1、1～4であれば2)に設定して下さい。</p>
	</div>
	<h3>アクセス時にスピンドルモータが回らずエラーとなる</h3>
	<div class="block">
		<p>モータオン条件が間違っているか、ケーブルの取り付け位置が間違っている可能性が高いです。Aドライブとして使う場合は、ストレートケーブルではなく、10～16ピンをクロスさせたケーブルを使う必要があります(B側であればストレート結線として下さい)。また、モータオン条件には、MOTOR ON信号か、MOTOR ON * DRIVE SELECTを使うように設定して下さい。</p>
	</div>
</div>

<h2>ざっくりとした要約</h2>
<div class="block">
	<h3>少なくとも内蔵3.5インチFDDを接続できるPCが必要</h3>
	<div class="block">
		<p>最近のPCは内蔵FDD用のコネクタが無い場合が多い。あったとしても、ドライブB側は配線が省略されているものがほとんど。
しかしながら、FDD用のコネクタさえ搭載されていれば、最悪でもAドライブとして5インチFDDを使うことは可能。</p>
	</div>
	
	<h3>ドライブを買うならTEAC FD-55GFR-7000番台か、日本電気FD1155C/DかFD1157C/D</h3>
	<div class="block">
		<p>もし新規にドライブを買いたいなら、中古の上記ドライブが良。前者はAT互換機用なのでハマり所が少ない(メカも少ないけど)。後者も動作良好な上に、在庫潤沢かつドライブ自体も頑丈(ヘッドカバーのトラブル、LEDつかない、ベゼル無し等には注意)。当然他にも使用可能なドライブはあるが(元々AT互換機用のもの等)、選択を誤ると、特にREADY信号周りで修羅の道に続いていることがある。</p>
	</div>
	
	<h3>中古で買ったドライブには適切なジャンパ設定をすること</h3>
	<div class="block">
		<p >めざすべき設定は<a href="#connect">こちら</a>。上手く動かない場合の判断は<a href="#trouble">こちら</a>。</p>
	</div>
	
	<h3>ATの世界には2DD/2HD自動切替のための標準機能が無い。差し支えなければどちらか固定で運用する</h3>
	<div class="block">
		<p>但し、スーパI/Oチップが対応していてBIOSが適切な初期化を行っていればOK。<a href="#oredrv">拙作ドライバ</a>が対応しているチップでもOK。</p>
	</div>
	
	<h3>カードエッジ型のコネクタを持つFDDケーブルの入手が困難</h3>
	<div class="block">
		<p>途中で一部線がクロスしているケーブルでないと、Aドライブ側として使えない。手持ちに無いなら、ジャンク屋を漁るか、自分で圧着するか、特注で作ってもらうこと。</p>
	</div>
	
	<h3>Windows NT系でMS-DOSディスク(1.25MB/640KB等)を使うだけなら<a href="#oredrv">拙作ドライバ</a>を使えばOK</h3>
	<div class="block">
		<p>但し、x86版しか用意してません。</p>
	</div>
	
	<h3>特殊フォーマットの吸い出しは「DITT.EXE」を使う</h3>
	<div class="block">
		<p>N88 DISK BASICやOASYS文書ディスク等がこれに該当。とりあえずD88形式のイメージとしてHDD上に吸い出しておき、後でWindows上なりで必要な処理をかける(バイナリエディタで必要なセクタデータを回収するとか)。本物のMS-DOSでブートするよりも、FreeDOSを使ってUSBメモリブートした方が良いかも?</p>
	</div>
	
	<h3>Windows 9x系のOSを使う場合は要注意</h3>
	<div class="block">
		<p>READY信号が出ているドライブでも使えるし、そのままで2HDにアクセスできるので重宝するものの、IPLセクタを勝手に破壊するバグがある。</p>
	</div>
	
	<h3>FM記録のセクタを読めないFDCが存在するらしいので、特殊フォーマットを扱いたい場合は要注意</h3>
	<div class="block">
		<p>OASYSの文書ディスクや、汎用機系フォーマット等が被害を受ける。</p>
	</div>
	
</div>

<h2>最後に</h2>
<div class="block">
	<p>結構ゴチャゴチャになってしまいましたが、わからない所や質問などがありましたら<a href="http://development-room.bbs.fc2.com/">ゲストブック</a>か<a href="index.html#footer">メール</a>にてお願いします。わかる範囲でお答えさせていただきます。また、間違っている箇所のご指摘や、記述が曖昧になっている箇所の「正しい情報」もお寄せ頂けるとありがたいです。</p>
	<p>尚、これらの情報を利用して行動に移そうという方は、くれぐれも自己責任でお願いします。どんな損害が発生しても責任はとれませんので。</p>
	<div class="memo">
		<div class="memo_blk1">8インチFDD</div>
		<div class="memo_blk2">
		<p>余興です。これらの情報は、8インチFDDをAT互換機に付ける場合にも生かせるかもしれません。ドライバの説明書にも書いてあると思いますが、以前、Y-Eデータ製のドライブを使って読み書きすることに成功しています(Windows上で5インチ2HDみたいに使えました)。現在は手元に無く、ドライブの型番も失念してしましたが、以下のような特徴があったはずです。</a>
		<ul class="list">
			<li>信号線は50ピンの<b>ピンヘッダ</b>で、34ピン⇔50ピンのリボンケーブルを自作して対応</li>
			<li>日本電気のドライブとは信号並びが違ったはず。確か1ピン寄りの信号側ピンが暫くNCだったので一発で区別できた記憶が…</li>
			<li>ドライブの厚さは一般的な5インチドライブと同じ</li>
			<li>5インチドライブと同様のレバー式ドア</li>
			<li>電源コネクタは一般的な4ピンのものだが、12V→24V</li>
			<li>それなのに12V電源を繋いで上手く動いた</li>
			<li>全体的に5インチFDDのような作りで、日本電気のFD1165Aと比べると比較的新しい設計のように見えた</li>
		</ul>
		<p>注意すべき点として、物理的なトラックの数が異なるので(8インチは最大77シリンダ、5インチは80+2シリンダ)、起動時のシーク動作やディスクイメージの作成等で78シリンダ以上にアクセスしようとすると、ヘッドが脱落したりズレたりする可能性があります(手持ちのドライブでも何度か経験済ですが、脱落せずにガチガチ言うだけで済みました。トラック位置もずれなかったようです。デカイので、ずれたとしても5インチよりは直すのがラクだと思われますが…)。</p>
		<p>もし試そうとされる場合は、SA-400とインタフェースレベルでの電気的な互換性があるかどうか(オープンコレクタで負論理で150Ωで5Vにプルアップで…等)について事前に調べておくことをおすすめします(例えばSA-800と同じなら互換あり)。試したドライブではたまたま互換があったようですので。</p></div>
	</div>
</div>
</div>

<div class="footer">
	<div style="text-align:center"><a href="index.html">トップページ</a></div>
	<div style="font-size:12px; text-align:right">Copyright(c) 2003 聖人(Kiyoto).</div>
</div>

<!-- [FC2 Analyzer] //analyzer.fc2.com/  -->
<script language="javascript" src="//analyzer51.fc2.com/ana/processor.php?uid=2455023" type="text/javascript"></script>
<noscript><div align="right"><img src="//analyzer51.fc2.com/ana/icon.php?uid=2455023&ref=&href=&wid=0&hei=0&col=0" /></div></noscript>
<!-- [FC2 Analyzer]  -->

</body>
</html>

